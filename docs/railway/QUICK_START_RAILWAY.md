# 🚀 Быстрый старт на Railway.com

## 📦 Что было сделано для деплоя

Ваш проект готов к размещению на Railway! Вот что было добавлено:

### ✅ Создано 8 новых файлов:

1. **`api_server.py`** - FastAPI веб-сервер с:
   - ✅ Веб-интерфейсом для загрузки остатков
   - ✅ REST API для управления парсингом
   - ✅ Отображением даты актуальности: **"Остатки актуальны на DD.MM.YYYY"**
   - ✅ Скачиванием отчетов

2. **`Dockerfile`** - Контейнер с Chrome для парсинга

3. **`.dockerignore`** - Исключения для Docker

4. **`railway.json`** - Конфигурация Railway

5. **`requirements.railway.txt`** - Зависимости без Windows-only пакетов

6. **`RAILWAY_DEPLOYMENT_PLAN.md`** - Детальный план деплоя

7. **`RAILWAY_DEPLOY.md`** - Пошаговая инструкция

8. **`INVENTORY_UPLOAD_GUIDE.md`** - Руководство по загрузке остатков

9. **`README_RAILWAY.md`** - Полная документация

### ✅ Изменено:

- **`config.py`** - `headless: True` для Railway

---

## 🎯 Деплой за 5 минут

### Шаг 1: Загрузить код на GitHub

```bash
git add .
git commit -m "Add Railway deployment support"
git push origin main
```

### Шаг 2: Создать проект на Railway

1. Открыть [railway.com](https://railway.com)
2. **New Project** → **Deploy from GitHub repo**
3. Выбрать ваш репозиторий
4. Railway автоматически обнаружит `Dockerfile` ✅

### Шаг 3: Настроить Volume (хранилище)

1. Railway Dashboard → **Settings** → **Volumes**
2. **New Volume**
3. Mount Path: `/app/data`
4. Size: 1 GB
5. **Save**

### Шаг 4: Получить URL

1. Settings → **Networking** → **Generate Domain**
2. Ваш URL: `https://your-app.railway.app`

### Шаг 5: Использовать!

Откройте в браузере: `https://your-app.railway.app`

---

## 💻 Что вы увидите

### Главная страница

```
┌─────────────────────────────────────────────────────┐
│         ☕ Coffee Price Monitoring API              │
│    Автоматический мониторинг цен на кофемашины     │
└─────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────┐
│ ⚠️ Файл с остатками не загружен                     │
│    Загрузите файл остатков для сравнения цен       │
└─────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────┐
│         📤 Загрузка файла с остатками               │
│                                                      │
│    [Выбрать файл]  [⬆️ Загрузить файл]             │
└─────────────────────────────────────────────────────┘

После загрузки:

┌─────────────────────────────────────────────────────┐
│ ✅ Файл с остатками загружен                        │
│ 📅 Остатки актуальны на: 14.10.2025                │
│ 📦 Товаров: 76                                      │
│ 📄 Файл: остатки.xlsx                              │
└─────────────────────────────────────────────────────┘
```

### Кнопка запуска

```
┌─────────────────────────────────────────────────────┐
│            🚀 Запуск парсинга                       │
│                                                      │
│      [▶️ Запустить полный цикл (все 4 сайта)]      │
│                                                      │
│   ┌──────┐  ┌──────┐  ┌──────┐  ┌──────┐          │
│   │  74  │  │  28  │  │  40  │  │  41  │          │
│   │ALTA  │  │KONTAKT│  │ELITE │  │DIMKAVA│         │
│   └──────┘  └──────┘  └──────┘  └──────┘          │
└─────────────────────────────────────────────────────┘
```

---

## 🔄 Типичный рабочий процесс

### Вариант 1: Через веб-интерфейс (для директора)

```
1. Открыть https://your-app.railway.app/
2. Загрузить файл остатков → видит дату "14.10.2025"
3. Нажать "Запустить полный цикл"
4. Подождать 2-3 минуты
5. Скачать отчет
```

### Вариант 2: Через API (для автоматизации)

```bash
# 1. Загрузить остатки
curl -X POST https://your-app.railway.app/inventory/upload \
  -F "file=@остатки.xlsx"

# Ответ: "Остатки актуальны на 14.10.2025"

# 2. Запустить парсинг
curl -X POST https://your-app.railway.app/scrape/all

# 3. Скачать отчет
curl https://your-app.railway.app/reports/latest -o report.xlsx
```

### Вариант 3: Автоматический запуск (Cron)

**Настроить Cron Job на Railway или cron-job.org:**

```
Расписание: 0 9 * * * (каждый день в 9:00)
Действие: POST https://your-app.railway.app/scrape/all
```

---

## 📱 API Endpoints

### Управление остатками (НОВОЕ!)

```
POST   /inventory/upload    - Загрузить файл остатков
GET    /inventory/info      - Информация + дата актуальности
GET    /inventory/download  - Скачать файл
```

**Пример ответа `/inventory/info`:**
```json
{
  "has_file": true,
  "filename": "остатки.xlsx",
  "uploaded_at_formatted": "14.10.2025",
  "products_count": 76,
  "message": "Остатки актуальны на 14.10.2025"
}
```

### Парсинг

```
POST   /scrape/all       - Все 4 сайта (183 товара)
POST   /scrape/alta      - ALTA (74 товара)
POST   /scrape/kontakt   - KONTAKT (28 товаров)
POST   /scrape/elite     - ELITE (40 товаров)
POST   /scrape/dimkava   - DIM_KAVA (41 товар)
```

### Отчеты

```
GET    /reports/latest     - Последний Excel отчет
GET    /reports/executive  - Отчет для руководства
GET    /reports/list       - Список всех отчетов
```

### Статус

```
GET    /status   - Статус парсинга
GET    /health   - Health check (+ дата остатков!)
GET    /docs     - Swagger документация
```

---

## 🎨 Что показывает дата актуальности

### В веб-интерфейсе:

```
✅ Файл с остатками загружен
📅 Остатки актуальны на: 14.10.2025
📦 Товаров: 76
📄 Файл: остатки.xlsx
```

### В API (/inventory/info):

```json
{
  "uploaded_at_formatted": "14.10.2025",
  "message": "Остатки актуальны на 14.10.2025"
}
```

### В health check (/health):

```json
{
  "status": "healthy",
  "inventory": {
    "loaded": true,
    "date": "14.10.2025"
  }
}
```

---

## 💾 Где хранятся файлы

### Railway Volume: `/app/data`

```
/app/data/
├── inbox/
│   ├── остатки.xlsx                  ← Ваш файл
│   └── inventory_metadata.json       ← Дата загрузки
├── output/
│   ├── price_comparison_*.xlsx       ← Отчеты
│   └── executive_report_*.pdf
└── logs/
    └── scraper.log
```

**Преимущества Volume**:
- ✅ Файлы сохраняются между перезапусками
- ✅ Автоматические бэкапы
- ✅ 1 GB места (достаточно для сотен отчетов)

---

## 🔧 Локальное тестирование

### Без Docker:

```bash
# Установить зависимости
pip install -r requirements.railway.txt

# Запустить сервер
uvicorn api_server:app --reload

# Открыть браузер
open http://localhost:8000
```

### С Docker:

```bash
# Собрать
docker build -t coffee-scraper .

# Запустить
docker run -p 8000:8000 coffee-scraper

# Открыть браузер
open http://localhost:8000
```

---

## 💰 Стоимость

### Railway Free Tier (достаточно!)

```
✅ $5 бесплатных кредитов в месяц
✅ 500 часов выполнения
✅ 1 GB памяти
✅ 1 GB хранилища

Стоимость этого проекта: ~$5/месяц
Итого: БЕСПЛАТНО! 🎉
```

---

## 📚 Документация

| Файл | Описание |
|------|----------|
| **QUICK_START_RAILWAY.md** | Этот файл - быстрый старт |
| **README_RAILWAY.md** | Полная документация Railway |
| **RAILWAY_DEPLOYMENT_PLAN.md** | Детальный план с архитектурой |
| **RAILWAY_DEPLOY.md** | Пошаговая инструкция деплоя |
| **INVENTORY_UPLOAD_GUIDE.md** | Загрузка остатков + дата |

---

## ✅ Чеклист

- [ ] Код загружен на GitHub
- [ ] Проект создан на Railway
- [ ] Volume настроен (`/app/data`)
- [ ] Домен сгенерирован
- [ ] Веб-интерфейс открывается
- [ ] Файл остатков загружен
- [ ] Дата актуальности отображается
- [ ] Парсинг работает
- [ ] Отчеты скачиваются

---

## 🎉 Готово!

После деплоя ваше приложение:

✅ **Доступно 24/7** на Railway  
✅ **Показывает дату остатков**: "Остатки актуальны на DD.MM.YYYY"  
✅ **Позволяет загружать файлы** через браузер  
✅ **Запускает парсинг** по кнопке или по расписанию  
✅ **Генерирует отчеты** автоматически  

**Главная страница**: https://your-app.railway.app/

**Swagger Docs**: https://your-app.railway.app/docs

Наслаждайтесь! ☕🚀

